---
title: "Course5Project1"
author: "ajf"
date: "8/28/2022"
output: html_document
---
# Course 5 Project 1

## Reading in the dataset

First, it is necessary to set the working directory. This line needs to be adapted. Aditionally, a folder is created - if it does not already exists - to store the files related to this project.

```{r echo=TRUE}
setwd("/Users/a.jimenez/Desktop/Curso DA/datasciencecoursera/")
if(!dir.exists("CourseProject_5.2")){dir.create("CourseProject_5.2")}
setwd("./CourseProject_5.2/")
```

Then, the file with the data is downloaded, unzipped and read. 

```{r echo=TRUE}
if(!file.exists("activity.zip")){
  link <- "https://d396qusza40orc.cloudfront.net/repdata%2Fdata%2Factivity.zip"
  download.file(link, "activity.zip", method = "curl")
}

if(!file.exists("activity.csv")){
  unzip("activity.zip")
}

data <- read.csv("activity.csv",header=TRUE)
head(data)
```

Variable *interval* is modified to adjust to the **%H%M** format.
Then a variable *time* is created using **strptime** that contains a combination of the day and the time of the measure.

AUX SE USA???

```{r echo=TRUE}
for(i in 1:length(data$interval)){
  if (data$interval[i]<10){
    data$aux[i]<- as.character(data$interval[i])
    data$aux[i] <- sub(data$aux[i],paste("000",data$aux[i],sep=""),data$aux[i])
  }
  else if (data$interval[i]<100 & data$interval[i]>=10){
    data$aux[i]<- as.character(data$interval[i])
    data$aux[i] <- sub(data$aux[i],paste("00",data$aux[i],sep=""),data$aux[i])
  }
  else if (data$interval[i]<1000 & data$interval[i]>=100){
    data$aux[i]<- as.character(data$interval[i])
    data$aux[i] <- sub(data$aux[i],paste("0",data$aux[i],sep=""),data$aux[i])
  }else if (data$interval[i]>=1000){
    data$aux[i]<- as.character(data$interval[i])
  }
}

data$time <- strptime(as.character(paste(data$date,data$aux)), "%Y-%m-%d %H%M")
data$aux <- strptime(as.character(data$aux), "%H%M") # no se puede evitar q aÃ±ada fecha?
```


## Histogram of the total number of steps taken each day

Histogram generated by grouping and adding up the step measures from each day.

```{r echo=TRUE}
library(ggplot2)
library(dplyr)

by_date <- data %>% group_by(date) %>% 
  summarize(sum=sum(steps, na.rm=TRUE))

p1 <- by_date %>%
    ggplot( aes(x=sum)) +
    geom_histogram(fill="#69b3a2", color="#e9ecef", alpha=0.9, bins=20) +
    ggtitle("Daily steps histagram") + xlab("Steps per day") + ylab("Days")
p1
```


## Mean and median number of steps taken each day

Here, we use againg the data grouped by date and the sum of steps from each day to calculate the average.

```{r echo=TRUE}
mean_steps <- round(mean(by_date$sum, na.rm=TRUE))
median_steps <- median(by_date$sum, na.rm=TRUE)
```

The **mean** is **`r mean_steps` steps per day** and the **median** is **`r median_steps` steps per day**.


## Time series plot of the average number of steps taken

In a scatterplot the total daily steps are plotted against the days.

```{r echo=TRUE}
by_date$date <- as.Date(by_date$date)
p2 <- by_date %>%
  ggplot( aes(x=date,y=sum)) +
  geom_point(color="#69b3a2", pch=20) +
  ggtitle("Daily steps") + xlab("Date") + ylab("Steps")+
  geom_smooth(color="black",lwd=0.5)
  
p2
```


## The 5-minute interval that, on average, contains the maximum number of steps

Now the data is grouped by *interval* and the mean number of steps is calculated. Then, the highest mean is filtered. 
The *hms library* is used to extract just the time from the POISXlt object. 

```{r echo=TRUE}
library(hms)
by_interval <- data %>% group_by(interval) %>% 
  summarize(mean=mean(steps, na.rm=TRUE))

by_interval <- data %>% group_by(aux) %>% 
  summarize(mean=mean(steps, na.rm=TRUE))

max <- by_interval %>% filter(mean== max(by_interval$mean, na.rm=TRUE)) 
max <- as.character(as_hms(max$aux)) 
```

The interval with maximun number of steps is **`r max`**.


## Code to describe and show a strategy for imputing missing data

Here, the percentage of missing values is calculated.

```{r echo=TRUE}
miss <- paste(round(mean(is.na(data$steps))*100),"%")
```

There is a `r miss` of missing data.

Is there a pattern in the missing data?
Lattice is used to plot for each day the occurence of missing data.
ggplot2 is used to plot in a single facet.
Both plots show the same.

```{r echo=TRUE}
data$missing <- is.na(data$steps)

library(lattice)
xyplot(missing ~ interval | date, data = data, layout = c(8, 8))

cal_NA <- data %>% group_by(date) %>% 
  summarize(mean=mean(missing, na.rm=TRUE))

p3 <- cal_NA %>%
  ggplot( aes(x=date,y=mean)) +
  geom_point(color="#69b3a2", pch=20) +
  ggtitle("Percentage of missing values") + xlab("Date") + ylab("p")
p3
```

Missing data happens on 8 specific days. My guess is that the person is not using the device.

There are also many 0 steps intervals. Precisely:
```{r echo=TRUE}
mean(data$steps==0, na.rm=TRUE) 
data$cero <- data$steps==0

xyplot(steps ~ as.POSIXct(aux) | date, data = data, layout = c(8, 8))
```

It looks they come from no movement. Sleeping time is quite clear from the graphs.
Here a zoom in a day randomly chosen. 

```{r echo=TRUE}
data$date <- as.character(data$date)
oneday <- data %>% filter(date=="2012-10-16")
library(lubridate)
plot(as.POSIXct(oneday$time), oneday$steps, main=wday(oneday$time[1],label=TRUE,abbr = FALSE))
```


## Histogram of the total number of steps taken each day after missing values are imputed
I fail to understand how the missing values affect to the sum up of the daily steps.
The histogram is the same. 


## Panel plot comparing the average number of steps taken per 5-minute interval across weekdays and weekends

Here, using lubridate (called before) two new variables are generated to identify first the weekday and the to assign it to Weekday or Weekend.
Plot the two groups in different colors.

```{r echo=TRUE}
data$wday <- wday(data$time)
data$week <- sub("[2-6]","Weekday",as.character(data$wday))
data$week <- sub("[1,7]","Weekend",as.character(data$week))
data$week <- as.factor(data$week)

data %>% group_by(week) %>% summarize(mean=mean(steps,na.rm=TRUE))
winte <- data %>% group_by(week,aux) %>% summarize(mean=mean(steps,na.rm=TRUE))

p4 <- winte %>%
  ggplot( aes(x=as_hms(winte$aux),y=mean, color=week)) +
  geom_point(pch=20) +
  ggtitle("Average steps per 5-minute interval") + xlab("Day hour") + ylab("Steps")
p4
```

During the weekdays the activity is higher in the early morning. The user probably sleeps in during the weekend. The afternoon activity is higher during weekends.



